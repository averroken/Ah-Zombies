"use strict";var TopDownGame=TopDownGame||{},result;TopDownGame.room_1=function(){},TopDownGame.room_1.prototype={create:function(){this.createMap(),this.map.addTilesetImage("cute_lpc","dungeonTiles"),this.backgroundlayer=this.map.createLayer("backgroundLayer"),this.blockedLayer=this.map.createLayer("blockedLayer"),this.map.setCollisionBetween(1,2e3,!0,"blockedLayer"),this.backgroundlayer.resizeWorld(),this.count=0,result=this.findSpawnPoint("playerStart",this.map,"objectsLayer",this.position),this.player=this.game.add.sprite(result[0].x,result[0].y,"player"),this.player.id=Player.Id,socket.emit("getPlayers"),socket.emit("moveMyPlayer",{id:this.player.id,x:this.player.x,y:this.player.y,map:Player.Map}),this.player.velocity=75,this.game.physics.arcade.enable(this.player),this.game.camera.follow(this.player),this.cursors=this.game.input.keyboard.createCursorKeys(),this.game.scale.fullScreenScaleMode=Phaser.ScaleManager.SHOW_ALL,this.createItems(),this.createDoors(),this.addGamePad(),this.addButtons()},gofull:function(){this.game.scale.isFullScreen?this.game.scale.stopFullScreen():this.game.scale.startFullScreen(!1)},enableJoysticks:function(){this.joystick.enabled=!this.joystick.enabled,this.joystick.visible=!this.joystick.visible,this.button.visible=!this.button.visible,this.gamepad.joystickPad.visible=!this.gamepad.joystickPad.visible},createMap:function(){this.map=this.game.add.tilemap("room_1"),this.position||(this.position="down")},createItems:function(){console.log(this.map),this.items=this.game.add.group(),this.items.enableBody=!0;items.length>=0?console.log(items.length):(result=this.findObjectsByType("item",this.map,"objectsLayer"),items=result,socket.emit("setItemList",items,this.map.key)),items.forEach(function(t){this.createFromTiledObject(t,this.items)},this)},createDoors:function(){this.doors=this.game.add.group(),this.doors.enableBody=!0,result=this.findObjectsByType("door",this.map,"objectsLayer"),result.forEach(function(t){this.createFromTiledObject(t,this.doors)},this)},addGamePad:function(){this.gamepad=this.game.plugins.add(Phaser.Plugin.VirtualGamepad),this.joystick=this.gamepad.addJoystick(50,this.game.height-50,.5,"gamepad"),this.button=this.gamepad.addButton(this.game.width-50,this.game.height-50,.5,"gamepad"),this.joystick.enabled=!1,this.joystick.visible=!1,this.button.visible=!1,this.gamepad.joystickPad.visible=!1},addButtons:function(){this.buttons=this.game.add.group(),this.fullScreenButton=this.add.button(this.game.width-25,5,"fullScreenButton",this.gofull,this,0,0,0,0,this.buttons),this.fullScreenButton.fixedToCamera=!0,this.joystickButton=this.add.button(this.game.width-25,30,"joystickButton",this.enableJoysticks,this,0,0,0,0,this.buttons),this.joystickButton.fixedToCamera=!0,this.game.world.bringToTop(this.buttons)},findSpawnPoint:function(t,e,i,s){var o=new Array;if(!(o.length<0))return e.objects[i].forEach(function(i){var a=0;void 0!=i.properties.offset&&(a=i.properties.offset),i.properties.spawnPoint===s&&i.properties.type===t&&(i.y-=e.tileHeight+45+a,o.push(i))}),o},findObjectsByType:function(t,e,i){var s=new Array;if(!(s.length<0))return e.objects[i].forEach(function(i){var o=0;void 0!=i.properties.offset&&(o=i.properties.offset),i.properties.type===t&&(i.y-=e.tileHeight+45+o,s.push(i))}),s},createFromTiledObject:function(t,e){var i=e.create(t.x,t.y,t.properties.sprite);Object.keys(t.properties).forEach(function(e){i[e]=t.properties[e]})},collect:function(t,e){console.log(this.map);var i=this.map;"bluecup"!=e.sprite&&"greencup"!=e.sprite||(t.velocity=100),e.destroy(),items.forEach(function(t){if(t.x===e.position.x&&t.y===e.position.y){var s=items.indexOf(t);items.splice(s,1),console.log(items.length),console.log(i.key),socket.emit("updateItemList",items,i.key)}})},enterDoor:function(t,e){var i=e.targetTileMap.split("|");console.log("entering the door"),console.log("targetTileMap: "+i[0]),socket.emit("changeMap",i[0],Player.Id),console.log("entering the door"),console.log("targetTileMap: "+i[0]),console.log("targetSpawnPoint: "+i[1]),TopDownGame.game.state.states[i[0]].position=i[1],TopDownGame.game.state.start(i[0])},update:function(){var t=!1;this.joystick.enabled&&this.logJoystick(),this.player.body.velocity.y=0,this.player.body.velocity.x=0,this.cursors.up.isDown?(this.player.body.velocity.y-=this.player.velocity,t=!0):this.cursors.down.isDown&&(this.player.body.velocity.y+=this.player.velocity,t=!0),this.cursors.left.isDown?(this.player.body.velocity.x-=this.player.velocity,t=!0):this.cursors.right.isDown&&(this.player.body.velocity.x+=this.player.velocity,t=!0),this.game.physics.arcade.collide(this.player,this.blockedLayer),this.game.physics.arcade.overlap(this.player,this.items,this.collect,null,this),this.game.physics.arcade.overlap(this.player,this.doors,this.enterDoor,null,this),t&&(this.count++,this.count%2==0&&socket.emit("moveMyPlayer",{id:this.player.id,x:this.player.x,y:this.player.y,map:Player.Map}))},logJoystick:function(){this.joystick.properties.up?this.cursors.up.isDown=!0:this.cursors.up.isDown=!1,this.joystick.properties.down?this.cursors.down.isDown=!0:this.cursors.down.isDown=!1,this.joystick.properties.right?this.cursors.right.isDown=!0:this.cursors.right.isDown=!1,this.joystick.properties.left?this.cursors.left.isDown=!0:this.cursors.left.isDown=!1}};
//# sourceMappingURL=room_1.js.map
