<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Phaser 2D tutorial</title>
    <script type="text/javascript" src="js/phaser.js"></script>
    <script type="text/javascript" src="js/Boot.js"></script>
    <script type="text/javascript" src="js/Preload.js"></script>
    <script type="text/javascript" src="js/Game.js"></script>
    <script type="text/javascript" src="js/Game2.js"></script>
    <script type="text/javascript" src="js/largeMapTest.js"></script>
    <script type="text/javascript" src="js/room_1.js"></script>
    <script type="text/javascript" src="js/room_2.js"></script>
    <script type="text/javascript" src="js/room_3.js"></script>
    <script type="text/javascript" src="js/room_4.js"></script>
    <script type="text/javascript" src="js/room_5.js"></script>
    <script type="text/javascript" src="js/room_6.js"></script>
    <script type="text/javascript" src="js/room_7.js"></script>
    <script type="text/javascript" src="js/room_8.js"></script>
    <link rel="stylesheet" src="css/style.css" />
</head>

<body>
<script>
    var windowx = document.window.width;
    var windowy = document.window.height;
</script>
    <script type="text/javascript" src="js/main.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <div id="game">
        <div id="left"></div>
        <div id="right"></div>
    </div>
    <script src="dist/nipplejs.js" charset="utf-8"></script>
    <script>
        var joystickL = nipplejs.create({
            zone: document.getElementById('left'),
            mode: 'static',
            position: { left: '10%', top: '78%' },
            color: 'white',
            size: 65
        });

        var joystickR = nipplejs.create({
            zone: document.getElementById('right'),
            mode: 'static',
            position: { right: '10%', bottom: '22%' },
            color: 'white',
            size: 65
        });
    </script>
    <script type="text/javascript">
        var socket = io();
        var idSet = false;
        var buddies = {};
        var myId;
        var game = TopDownGame.game;
        var cursor; //= game.input.keyboard.createCursorKeys().left;

        socket.on('yourId', function(data) {
            setId(data.id);
        });

        function beweegPeetje(direction) {
            switch(direction){
                case "left":
                    cursor.left.isDown = true
                    return;

                case "right":
                    cursor.right.isDown = true
                    return;

                case "up":
                    cursor.up.isDown = true
                    return;

                case "down":
                    cursor.down.isDown = true
                    return;

                default: return;
            }
        }

        joystickL.on('move dir start', function (evt, data) {
            if(!cursor) cursor = game.input.keyboard.createCursorKeys();
            //console.log(data);
            if (data.direction){
                var direction = data.direction.angle;
                //console.log(direction);
                beweegPeetje(direction);
            }
        });

        joystickL.on('end', function (evt, data) {
            //console.log(data);
            cursor.down.isDown = false;
            cursor.up.isDown = false;
            cursor.right.isDown = false;
            cursor.left.isDown = false;
        });

            joystickR.on('move dir start end', function (evt, data) {
            if (data.angle){
                //var data = "<p>x direction: " +data.direction.x+ "</br>y direction: " +data.direction.y+ "</br>angle: "+data.direction.angle+ "</p>";
                var angle_degree = data.angle.degree;
                console.log(angle_degree);
            }
        });

        function setId(id) {
            if (!idSet) {
                console.log("my id:" + id);
                myId = id;
                idSet = true;
            }
        }

        socket.on('newBuddy', function(data) {
            console.log("data.id: " + buddies[data.id]);
            if (myId != data.id && !buddies[data.id] && data.x !== undefined) {

                console.log("NEW BUDDY");

                // // adding player
                console.log("x: " + data.x);
                console.log("y: " + data.y);
                test = game.add.sprite(50, 270, 'dude');

                //enable physics on player
                game.physics.arcade.enable(test);

                //giving the player physics properties
                test.body.bounce.y = 0.3;
                test.body.gravity.y = 300;
                test.body.collideWorldBounds = true;

                test.body.moves = false;

                //adding animations to player when walking
                test.animations.add('left', [0, 1, 2, 3], 10, true);
                test.animations.add('right', [5, 6, 7, 8], 10, true);

                test.id = data.id;

                // otherPlayers.add(test);
                buddies[data.id] = test;
            }
        });
    </script>
</body>

</html>
